# 지역 상태와 전역 상태 사용하기

## 용어 Check

### 멱등성

- 연산을 여러 번 적용하더라도 결과가 달라지지 않는 성질
- HTTP 메서드를 예로 들자면, 동일한 요청을 한 번 보내는 것과 여러 번 연속으로 보내는 것이 같은 효과를 지니고, 서버의 상태도 동일하게 남을 때, 해당 HTTP 메서드가 멱등성을 가졌다고 말한다.

### 억제됨 (contained)

- 특정 상태가 해당 컴포넌트 내에서만 사용되고 다른 컴포넌트에 영향을 미치지 않는 특성

### 순수 함수

오직 인수에만 의존하며 동일한 인수를 받는 경우 동일한 값을 반환

```JSX
const AddOne = ({ number }) => {
    return <div>{number + 1}</div>
}
```

## 지역 상태

- 특정 구역에서만 사용되는 상태

```JSX
const AddBase = ({ number }) => {
    const [base, changeBase] = useState(1);
    return <div>{ number + base }</div>
}
```

- changeBase로 base 상태를 변경하지 않는 이상 AddBase를 호출하면 항상 동일한 결과를 렌더링하기 때문에 멱등성을 지닌다고 볼 수 있다.
- changeBase는 해당 컴포넌트 렌더링 함수 내에서만 사용할 수 있기 때문에 억제(contained)되었다고 할 수 있다.
- 즉 AddBase 컴포넌트는 외부의 그 어떤 것에도 영향을 미치지 않기 때문에 지역성을 보장한다고 볼 수 있다.

## 지역 상태의 한계 (지역 상태를 사용하면 안되는 경우)

- 함수 컴포넌트 외부에서 컴포넌트 내부에있는 상태를 변경하고자 하는 경우
- AddBase 내부가 아닌 영역에서 base 상태를 바꾸고자 하는 경우

## 지역 상태를 효과적으로 사용하는 방법

### 상태 끌어올리기(Lifting State Up)

[예제코드](https://github.com/wikibook/msmrh/blob/main/chapter02/02_lift_state_up.js)

- 각각 다른 컴포넌트들에서 공유하여 사용하는 상태를 부모 컴포넌트에 위치시키고, 자식 컴포넌트의 prop으로 해당 상태를 공유/전달하여 사용할 수 있도록 한다.
- 해당 상태는 부모 컴포넌트에 속하지 않는 컴포넌트 외에서는 사용할 수 없으므로 지역 상태라고 볼 수 있다.
- 상태가 변경 되는 경우, 해당 상태가 위치하는 부모 컴포넌트에 위치한 모든 자식 컴포넌트를 포함해 하위 트리 전체를 리렌더링하기 때문에 성능 문제가 있을 수 있다.

### 내용 끌어올리기(Lifting Content Up)

[예제코드](https://github.com/wikibook/msmrh/blob/main/chapter02/03_lift_content_up.js)

- Parent 컴포넌트의 상태에 의존하지 않는 독단적인 컴포넌트가 Child 컴포넌트에 속한다면 GrandParent prop을 통해 컴포넌트 자체를 전달받아 렌더링한다.
- children prop을 통해 전달할 수도 있다.

```
💡 내용 끌어올리기가 리렌더링을 방지하는 근본적인 이유?

- 왜 예제의 Component1의 prop으로 <AdditionalInfo/>를 전달할 때에는 count가 바뀜에 따라 <AdditionalInfo/>가 리렌더링될까?
```

참고 : https://componentbasedcarlos.com/blog/using-children-props-to-prevent-rerenders-in-react-js/

참고 : https://kentcdodds.com/blog/optimize-react-re-renders

## 전역 상태

- 하나의 컴포넌트에만 속하지 않고 여러 컴포넌트에서 사용할 수 있는 상태
- 싱글턴으로서의 전역 상태
  - 애플리케이션 전체에서 하나의 인스턴스만 존재하는 상태를 의미
  - 이 상태는 애플리케이션 전체에서 공유된다.
  - 예를 들어, Redux와 같은 상태 관리 라이브러리를 사용할 때, 스토어는 애플리케이션의 모든 컴포넌트에서 공유되는 단일 데이터 저장소이다. 모든 컴포넌트가 이 스토어에 접근하고, 상태를 변경하거나 구독할 수 있다.
- 공유 상태로서의 전역 상태
  - 공유 상태는 여러 컴포넌트 간에 공유되는 상태를 의미한다.
  - 이 상태는 반드시 싱글톤일 필요는 없지만, 컴포넌트 간에 데이터와 상태를 공유해야 할 때 사용된다.
  - 예를 들어, React Context API를 사용하여 여러 컴포넌트가 동일한 상태를 사용할 수 있도록 할 수 있다. 이 경우, 상태가 특정 컴포넌트 트리 내에서만 유효할 수도 있습니다.

## 전역 상태가 필요한 경우

### prop을 전달하는 것이 적절하지 않을 때

[예제코드 16-87](https://github.com/wikibook/msmrh/blob/main/chapter02/04_globalstate.js#L16)

- 상위 컴포넌트의 상태를 깊은 뎁스의 컴포넌트로 전달할 때 중간 단계의 뎁스는 해당 상태를 직접 사용하지 않음에도 불구하고 prop으로 전달받아야한다. (비효율적인 props drilling 발생)
- 비효율적인 개발 경험
- 상위 컴포넌트의 상태가 변경되면 중간 뎁스의 컴포넌트도 리렌더링 되어 성능에 영향을 미친다.

### 이미 리액트 외부에 상태가 있을 때

[예제코드 89-101](https://github.com/wikibook/msmrh/blob/main/chapter02/04_globalstate.js#L89)

- 어떤 경우에는 외부에 전역 상태를 두는 편이 더 간단하다.
- 예를들어 앱에서 리액트 없이 획득한 사용자 인증 정보의 상태는 전역 상태로 저장될 수 있다.

```
💡 전역으로 상태를 관리하는 예시

- 사용자 인증 정보: 로그인한 사용자의 정보나 토큰 등
- 앱 설정: 사용자가 설정한 테마, 언어, 레이아웃 등
- 캐시된 데이터: 서버에서 가져온 데이터를 재사용할 경우
- 알림 및 메시지: 알림이나 오류 메시지 등의 전역적인 UI 상태
- 쇼핑 카트: 온라인 쇼핑 사이트에서 사용자가 담은 상품 목록 등
```

> 전역 상태는 컴포넌트 외부에서 리액트 컴포넌트 동작을 제어할 때 유용하게 사용할 수 있다.
> 컴포넌트 동작을 예측하기 어렵다는 단점이 있다.

## 정리

- 지역 상태를 기본으로 사용하고, 전역 상태는 보조 수단으로 사용하는 것이 좋다.
